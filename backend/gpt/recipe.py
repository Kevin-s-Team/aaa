import json

import gpt.task


class GptAssistedRecipeFinder(gpt.task.GptAssistedTask):

    def model(self):
        return 'gpt-3.5-turbo-16k'

    def max_tokens(self):
        return 12500


    def build_gpt_prompt(self, ingredients: [str]):
        """
        userInput = "ingrédients: "
        for i in range(0, len(ingredients)):
            userInput += ingredients[i] + ", "

        userInput = userInput[:-2]
        """
  
        return [
            {
                "role": "system",
                "content": "Tu vas incarner à tour de rôle et dans l'ordre les cuisinier suivants: \n1. Travis, un cuisinier spécialisé dans la cuisine moderne avant-gardiste.\n2. Stewen, un cuisinier spécialisé dans la cuisine traditionnelle asiatique. \n3. Germaine, une grand-mère spécialiste en cuisine traditionnelle française.\n4. Bernardo, un cuisinier spécialisé dans la cuisine traditionnelle italienne.\n5.  Miggin Mc Miggins, un cuisinier qui ne cuisine que dans la nature sur un feu de bois.  A à disposition uniquement un couteau et une marmite.\n\nTu reçois une liste d'ingrédients et tu crées une recette par cuisinier. \nRepart à zéro pour chaque cuisinier.\nTu ne peux pas utiliser des ingrédients qui ne sont pas dans la liste. De plus tu n'est pas obliger d'utiliser tous les ingrédients fournis. Si certains ingrédients ont une quantité précisée alors prend bien en compte ces quantités et propose une recette adaptée.\n\nLe résultat final doit respecter le format JSON suivant: { \"recipes\": [\n\t{\"dishName\": \"<nom de la recette cuisinier 1>\", \"dishDescription\": \"<description recette cuisinier 1>\", \"ingredients\" : \"<ingrédients utiliser par cuisinier 1>\", \"steps\": [\"<première étape de la recette>\", \"<deuxième étape de la recette>\", \"<troisième étape de la recette>\", \"etc.\" ]},\n\n{\"dishName\": \"<nom de la recette cuisinier 2>\", \"dishDescription\": \"<description recette cuisinier 2>\", \"ingredients\" : \"<ingrédients utiliser par cuisinier 2>\", \"steps\": [\"<première étape de la recette>\", \"<deuxième étape de la recette>\", \"<troisième étape de la recette>\", \"etc.\" ]},\n\netc.\n\n]\n\n}\n\nEn incarnant le cuisinier 1 effectue les étapes ci-dessous tout en complétant le JSON associé.  Recommence ensuite en incarnant le cuisinier 2, puis 3, etc.\n\n1. donne un nom à ta recette en précisant le cuisinier que tu as incarné et le style de la recette.\n\n2. génère une brève description de la recette.\n\n3. liste les ingrédients utilisés.\n\n4. présente de manière claire et concise les différentes étapes de la recette.\n\nInformations complémentaire:\n-le résultat stocker dans le JSON doit être en francais.\n"
            },
            {
                "role": "user",
                "content": "\"ingredients\": [\n{\"name\": \"carottes\", \"quantity\": {\"unit\": \"pièces\", \"value\": 10}}, \n{\"name\": \"tomates\", \"quantity\": {\"unit\": \"pièces\", \"value\": 10}},\n{\"name\": \"hachis de boeuf\", \"quantity\": {\"unit\": \"g\", \"value\": 500}},\n{\"name: \"oignons\"},\n{\"name\": \"beurre\"},\n{\"name\": \"crème\", \"quantity\": {\"unit\": \"ml\", \"value\": 250}},\n{\"name\": \"huile d'olives\"},\n{\"name\": \"parmesan\", \"quantity\": {\"unit\": \"g\", \"value\": 100}},\n{\"name\": \"sel\"},\n{\"name\": \"poivre\"}\n            ]"
            },
            {
                "role": "assistant",
                "content": "{\n    \"recipes\": [\n      {\n        \"dishName\": \"Carottes farcies au hachis de bœuf, style avant-gardiste et moderne par Travis\",\n        \"dishDescription\": \"Ces carottes farcies au hachis de bœuf et gratinées au parmesan sont une interprétation moderne et avant-gardiste d'un plat classique. Les carottes apportent une touche de douceur tandis que le hachis de bœuf et le parmesan ajoutent de la richesse et de la saveur.\",\n        \"ingredients\": \"- 10 carottes\\n- 10 tomates\\n- 500g de hachis de bœuf\\n- Oignons (quantité non précisée)\\n- Beurre (quantité non précisée)\\n- 250ml de crème\\n- Huile d'olive (quantité non précisée)\\n- 100g de parmesan\\n- Sel\\n- Poivre\",\n        \"steps\": [\n            \"Préchauffez le four à 180°C.\", \"Épluchez les carottes et coupez-les en deux dans le sens de la longueur. Retirez le centre de chaque moitié de carotte pour former une cavité.\", \"Émincez les oignons.\", \"Dans une poêle, faites fondre du beurre. Ajoutez les oignons émincés et faites-les revenir jusqu'à ce qu'ils soient translucides.\", \"Ajoutez le hachis de bœuf dans la poêle et faites-le cuire jusqu'à ce qu'il soit bien doré. Assaisonnez avec du sel et du poivre.\", \"Remplissez les cavités des carottes avec le mélange de hachis de bœuf.\", \"Dans un plat allant au four, disposez les carottes farcies et les tomates coupées en morceaux autour. Arrosez d'un filet d'huile d'olive.\", \"Versez la crème sur les carottes et les tomates.\", \"Saupoudrez le parmesan râpé sur le dessus.\", \"Enfournez pendant environ 30 minutes, jusqu'à ce que le fromage soit doré et bouillonne.\", \"Servez chaud et dégustez cette recette avant-gardiste !\"\n        ]\n      },\n      {\n        \"dishName\": \"Wok de légumes et boeuf au parmesan, style traditionnel asiatique par Stewen\",\n        \"dishDescription\": \"Une délicieuse et savoureuse recette de légumes frais et de hachis de boeuf sautés au wok, servis avec une sauce crémeuse au parmesan. Un plat équilibré et plein de saveurs, parfait pour un repas asiatique.\",\n        \"ingredients\": \"- 10 carottes\\n- 10 tomates\\n- 500g de hachis de boeuf\\n- Oignons (quantité non précisée)\\n- Beurre (quantité non précisée)\\n- 250ml de crème\\n- Huile d'olives (quantité non précisée)\\n- 100g de parmesan râpé\\n- Sel et poivre (quantité non précisée)\",\n        \"steps\": [\n            \"Épluchez les carottes et coupez-les en fines lamelles. Coupez également les tomates en petits dés.\", \"Dans un wok chaud, faites revenir les oignons dans du beurre jusqu'à ce qu'ils deviennent translucides.\", \"Ajoutez le hachis de boeuf dans le wok et faites-le cuire jusqu'à ce qu'il soit bien doré.\", \"Ajoutez les carottes et les tomates dans le wok. Faites sauter le tout pendant quelques minutes jusqu'à ce que les légumes soient légèrement tendres mais encore croquants.\", \"Dans un bol séparé, mélangez la crème et le parmesan râpé. Versez ce mélange dans le wok et remuez bien pour enrober les ingrédients.\", \"Assaisonnez avec du sel et du poivre selon vos goûts.\", \"Continuez à faire cuire le wok pendant encore quelques minutes jusqu'à ce que la sauce soit bien chaude et légèrement épaissie.\", \"Servez chaud et saupoudrez de parmesan râpé supplémentaire si désiré.\", \"Dégustez votre délicieux wok de légumes et boeuf au parmesan accompagné de riz ou de nouilles asiatiques.\"\n        ]\n      },\n      {\n        \"dishName\": \"Gratin de carottes au hachis de boeuf, style traditionnel français par Germaine\",\n        \"dishDescription\": \"Un délicieux gratin aux saveurs de la cuisine traditionnelle française : des carottes fondantes et un hachis de boeuf savoureux, le tout gratiné au four avec une délicieuse sauce crémeuse.\",\n        \"ingredients\": \"- 10 carottes\\n- 10 tomates\\n- 500g de hachis de boeuf\\n- Oignons\\n- Beurre\\n- 250ml de crème\\n- Huile d'olives\\n- 100g de parmesan\\n- Sel\\n- Poivre\",\n        \"steps\": [\n            \"Préchauffer le four à 180°C.\", \"Éplucher les carottes et les couper en rondelles. Les faire cuire à la vapeur ou les plonger dans de l'eau bouillante salée pendant 10 minutes. Égoutter.\", \"Pendant ce temps, émincer les oignons et les faire revenir dans une poêle avec un peu de beurre et d'huile d'olives jusqu'à ce qu'ils soient translucides.\", \"Ajouter le hachis de boeuf dans la poêle avec les oignons. Faire cuire à feu moyen jusqu'à ce que la viande soit bien dorée.\", \"Ajouter les tomates coupées en dés dans la poêle et laisser mijoter pendant 5 minutes.\", \"Dans un plat à gratin beurré, disposer une première couche de carottes cuites. Verser ensuite la moitié du mélange hachis de boeuf-tomates-oignons.\", \"Répéter l'opération avec une deuxième couche de carottes et le reste du mélange hachis de boeuf-tomates-oignons.\", \"Dans une casserole, faire chauffer la crème et ajouter le parmesan râpé. Mélanger jusqu'à obtention d'une sauce crémeuse. Saler et poivrer selon vos goûts.\", \"Verser la sauce sur le gratin et enfourner pendant 20 minutes, jusqu'à ce que le dessus soit doré et croustillant.\", \"Servir chaud et déguster ce délicieux gratin de carottes au hachis de boeuf à la française !\"\n        ]\n      },\n      {\n        \"dishName\": \"Polpette di carne con sugo di pomodoro, style traditionnel italien par Bernardo\",\n        \"dishDescription\": \"Les Polpette di carne con sugo di pomodoro sont de délicieuses boulettes de viande de boeuf servies avec une sauce tomate bien assaisonnée. Ces boulettes sont tendres, savoureuses et accompagnées d'une sauce tomate fraîche et parfumée. Un plat simple mais plein de saveurs de la cuisine traditionnelle italienne.\",\n        \"ingredients\": \"- 500g de hachis de boeuf\\n- 10 carottes\\n- 10 tomates\\n- 2 oignons\\n- 30g de beurre\\n- 250ml de crème\\n- 100g de parmesan\\n- Huile d'olive\\n- Sel\\n- Poivre\",\n        \"steps\": [\n            \"Éplucher et hacher finement les oignons.\", \"Dans une poêle, faire chauffer un peu d'huile d'olive. Ajouter les oignons hachés et les faire revenir jusqu'à ce qu'ils deviennent translucides.\", \"Ajouter le hachis de boeuf dans la poêle et le faire cuire jusqu'à ce qu'il soit bien doré et cuit à point.\", \"Pendant ce temps, éplucher et couper les carottes en petits dés.\", \"Ajouter les dés de carottes dans la poêle avec la viande et mélanger le tout.\", \"Dans une casserole séparée, faire bouillir de l'eau salée et y plonger les tomates pendant quelques minutes, puis les éplucher et les épépiner. Les couper ensuite en petits morceaux.\", \"Ajouter les tomates coupées dans la poêle avec la viande et les carottes. Assaisonner avec du sel et du poivre selon votre goût.\", \"Laisser mijoter la sauce à feu doux pendant environ 20-30 minutes, en remuant de temps en temps.\", \"Pendant que la sauce mijote, préparer les boulettes de viande. Dans un bol, mélanger le hachis de boeuf avec le parmesan râpé, du sel et du poivre.\", \"Former de petites boulettes avec le mélange de viande et les déposer dans une autre poêle avec un peu d'huile d'olive chaude.\", \"Faire cuire les boulettes de viande à feu moyen jusqu'à ce qu'elles soient bien dorées et cuites à l'intérieur.\", \"Une fois les boulettes de viande cuites, les ajouter à la sauce tomate.\", \"Dans une petite casserole, faire fondre le beurre et y incorporer la crème. Chauffer doucement jusqu'à ce que le mélange soit chaud et bien mélangé.\", \"Verser la sauce à la crème sur les boulettes de viande et la sauce tomate.\", \"Laisser mijoter le tout ensemble pendant encore quelques minutes, en remuant délicatement.\", \"Servir les Polpette di carne con sugo di pomodoro chaudes avec idéalement des pâtes ou du riz, saupoudrées de parmesan râpé.\"\n        ]\n      },\n      {\n        \"dishName\": \" Ragout de bœuf aux légumes, style \\\"dans la nature\\\" par Miggin Mc Miggins\",\n        \"dishDescription\": \"Un délicieux ragout de bœuf mijoté avec des carottes, des tomates et des oignons, le tout agrémenté d'une sauce crémeuse au parmesan.\",\n        \"ingredients\": \"- 10 carottes\\n- 10 tomates\\n- 500g de hachis de bœuf\\n- oignons\\n- beurre\\n- 250ml de crème\\n- huile d'olives\\n- 100g de parmesan\\n- sel\\n- poivre\",\n        \"steps\": [\n            \"Éplucher et couper les carottes en rondelles.\", \"Éplucher et hacher les oignons.\", \"Dans une marmite, faire fondre un peu de beurre et d'huile d'olives.\", \"Ajouter les oignons hachés et les faire revenir quelques minutes.\", \"Ajouter le hachis de bœuf dans la marmite et le faire cuire jusqu'à ce qu'il soit bien doré.\", \"Ajouter les carottes et les tomates coupées en morceaux dans la marmite.\", \"Saler et poivrer selon votre goût.\", \"Couvrir la marmite et laisser mijoter à feu doux pendant environ 1 heure, jusqu'à ce que les légumes soient tendres et la viande bien cuite.\", \"Ajouter la crème dans la marmite et mélanger délicatement.\", \"Râper le parmesan et l'ajouter à la préparation.\", \"Continuer la cuisson pendant quelques minutes, jusqu'à ce que le parmesan soit fondu et que la sauce soit bien crémeuse.\", \"Servir chaud et accompagner d'une portion de riz ou de pommes de terre si désiré.\"\n        ]\n      }\n    ]\n  }"
            },
            {
                "role": "user",
                "content": ingredients
            }
        ]

    def post_process_gpt_response(self, gpt_response_content: str):
        return json.loads(gpt_response_content)
